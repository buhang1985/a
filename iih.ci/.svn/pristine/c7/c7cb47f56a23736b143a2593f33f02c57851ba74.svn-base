package iih.ci.event.ord.bps.refund.sql;

import iih.ci.event.ord.utils.OrdEventUtil;

/**
 * 门诊诊疗退费BS303
 * @author F
 *
 * @date 2019年9月16日下午6:09:12
 *
 * @classpath iih.ci.event.ord.bps.refund.sql.OpTreatRefundSql
 */
public class OpTreatRefundSql {

	/**
	 * BS303
	 * 门诊治疗退费 就诊信息【IEOpTreatOrEnDTO】
	 * @return
	 */
	public String getOpTreatRefundEntInfoSql() {
		StringBuilder stringBuilder=new StringBuilder();
		stringBuilder.append(" select ");
		stringBuilder.append(" A.Id_En as id_ietreatoren, ");//就诊id
	    stringBuilder.append(" '' as ietreatfees, ");//IE治疗费用项集合
	    stringBuilder.append(" B.code as patient_id, ");//患者ID
	    stringBuilder.append(" b.barcode_chis as p_bar_code, ");//就诊号
	    stringBuilder.append(" C.Name_Pat as name, ");//患者姓名
	    stringBuilder.append(" C.Sd_Sex_Pat as sex, ");//性别编码
	    stringBuilder.append(" '' as age, ");//年龄
	    stringBuilder.append(" B.DT_BIRTH_HMS as birthday, ");//出生日期
	    stringBuilder.append(" I.code as apply_unit, ");//病人科室编码
	    stringBuilder.append(" I.name as apply_unit_name, ");//病人科室名称
	    stringBuilder.append(" (case when H.Times_Ip is null then 0 else H.Times_Ip end) + (case when J.Times_Op is null then 0 else J.Times_Op end) as admiss_times, ");//就诊次数
	    stringBuilder.append(" G.code as ward_code, ");//病区编码
	    stringBuilder.append(" G.Name as ward_code_name, ");//病区名称
	    stringBuilder.append(" H.NAME_BED as bed_no, ");//床位号
	    stringBuilder.append(" A.Dt_Chk as confrim_date, ");//医嘱确认时间
	    stringBuilder.append(" R.Code as confirm_opera, ");//确认护士编码
	    stringBuilder.append(" R.Name as confrim_opera_name, ");//确认护士姓名
	    stringBuilder.append(" '01' as domain_id, ");//域id
	    stringBuilder.append(" D.orgcode as orgcode, ");//医疗机构编码
	    stringBuilder.append(" D.name as orgname, ");//医疗机构名称
	    stringBuilder.append(" C.code as Visitordno, ");//就诊流水号
	    stringBuilder.append(" a.code_entp as Visittype, ");//就诊类别编码
	    stringBuilder.append(" BD.name as Visittypename, ");//就诊类别名称
	    stringBuilder.append(" L.code as exec_sn, ");//执行科室编码
	    stringBuilder.append(" M.code as apply_code ");//申请科室编码
		stringBuilder.append(" from ci_order A ");
		stringBuilder.append(" left outer join pi_pat B ON A.Id_Pat = B.Id_Pat ");
		stringBuilder.append(" left outer join en_ent C ON A.Id_En = C.Id_Ent ");
		stringBuilder.append(" left outer join en_ent_ip H ON C.Id_Ent = H.Id_Ent ");
		stringBuilder.append(" left outer join en_ent_op J ON A.Id_En = J.Id_Ent ");
		stringBuilder.append(" left outer join bd_dep G ON G.Id_Dep = C.Id_Dep_Nur ");
		stringBuilder.append(" left outer join bd_dep I ON I.Id_Dep = C.Id_Dep_Phy ");
		stringBuilder.append(" left outer join bd_psndoc R ON R.Id_Psndoc = A.Id_Emp_Chk ");
		stringBuilder.append(" left outer join bd_org D ON D.Id_org = A.Id_org ");
		stringBuilder.append(" left outer join BD_ENTP BD ON a.CODE_ENTP = BD.CODE ");
		stringBuilder.append(" left outer join bd_dep L ON L.Id_Dep = A.Id_Dep_Mp ");
		stringBuilder.append(" left outer join bd_dep M ON M.Id_Dep = A.Id_Dep_Or ");
		stringBuilder.append(" where A.id_or in (%s) ");
		return stringBuilder.toString();
	}
	/**
	 * BS303
	 * 门诊治疗退费 医嘱信息【IEOpTreatOrDTO】
	 * @return
	 */
	public String getOpTreatRefundOrdInfoSql() {
		StringBuilder stringBuilder=new StringBuilder();
		stringBuilder.append(" select ");
		stringBuilder.append(" A1.Id_Orsrv as id_ietreator, ");//服务id-父医嘱号
	    stringBuilder.append(" A.Id_En as id_ietreatoren, ");//就诊id
	    stringBuilder.append(" A1.id_pres as order_no, ");//诊疗处方号
	    stringBuilder.append(" a.code_or as yz_no, ");//医嘱号
	    stringBuilder.append(" D.Code as order_type, ");//医嘱类别编码
	    stringBuilder.append(" D.Name as order_type_name, ");//医嘱类别名称
	    stringBuilder.append(" A1.Note_Srv as yz_comment, ");//医嘱备注
	    stringBuilder.append(" E.Code as yz_code, ");//医嘱编码
	    stringBuilder.append(" E.Name as yz_name, ");//医嘱名称
	    stringBuilder.append(" F.Name as pack_serial, ");//包装序号
	    stringBuilder.append(" A1.Quan_Total_Medu as charge_amount, ");//数量
	    stringBuilder.append(" F.Name as spe_external, ");//数量单位
	    stringBuilder.append(" G.code as freq_code, ");//执行频率编码
	    stringBuilder.append(" G.name as freq_code_name, ");//执行频率
	    stringBuilder.append(" H.code as yz_olddept_code, ");//医嘱原科室编码
	    stringBuilder.append(" H.name as yz_olddept_name, ");//医嘱原科室名称
	    stringBuilder.append(" I.code as yz_oldward_code, ");//医嘱原病区编码
	    stringBuilder.append(" I.name as yz_oldward_name, ");//医嘱原病区名称
	    stringBuilder.append(" A.Dt_Entry as enter_date, ");//开嘱时间
	    stringBuilder.append(" J.Code as doctor_code, ");//开嘱医生编码
	    stringBuilder.append(" J.Name as doctor_name, ");//开嘱医生名称
	    stringBuilder.append(" A.Dt_Sign as confirm_date, ");//确认时间
	    stringBuilder.append(" K.code as confirm_opera, ");//确认医生编码
	    stringBuilder.append(" K.name as confirm_opera_name, ");//确认医生名称
	    stringBuilder.append(" L.code as exec_sn, ");//执行科室编码
	    stringBuilder.append(" L.Name as exec_name, ");//执行科室名称
	    stringBuilder.append(" A1.Id_Orsrv as parent_no, ");//父医嘱号
	    stringBuilder.append(" '' as incompatibleyz_no, ");//互斥类别编码
	    stringBuilder.append(" '' as incompatibleyz_type_code, ");//互斥类别名称
	    stringBuilder.append(" A.Dt_Effe as begin_time, ");//开始时间
	    stringBuilder.append(" A.Dt_End as end_time, ");//停止时间
	    stringBuilder.append(" M.Code as charge_gourp, ");//医保类别编码
	    stringBuilder.append(" M.Name as charge_group_name_external, ");//医保类别名称
	    stringBuilder.append(" A.des_or as comment1, ");//嘱托
	    stringBuilder.append(" '' as sginfee_code, ");//费用标记编码
	    stringBuilder.append(" '' as sginfee_name, ");//费用标记名称
	    stringBuilder.append(" A1.Fg_Skintest as is_ps, ");//是否皮试
	    stringBuilder.append(" (case when A1.Fg_Skintest = 'Y' then 'true' when A1.Fg_Skintest = 'N' then 'false' else '' end) as is_psresult, ");//皮试结果
	    stringBuilder.append(" A1.Fg_Indic as is_syz, ");//是否适应症
	    stringBuilder.append(" (case when A1.Fg_Indic = 'Y' then 'true' when A1.Fg_Indic = 'N' then 'false' else '' end) as is_syzresult, ");//是否适应症结果   
	    stringBuilder.append(" (case when G.Sd_Frequnitct = '0' and G.Code = 'ST' then 'Y' else 'N' end) as is_jj, ");//是否加急
	    stringBuilder.append(" (case when A.Fg_Urgent = 'Y' then '加急' when A.Fg_Urgent = 'N' then '非加急' else '' end) as is_jjresult, ");//是否加急结果
	    stringBuilder.append(" (case when H1.Times_Ip is null then 0 else H1.Times_Ip end) + (case when J1.Times_Op is null then 0 else J1.Times_Op end) as admiss_times, ");//就诊次数      
	    stringBuilder.append(" '' as is_yg, ");//是否药观
	    stringBuilder.append(" '' as is_ygresult, ");//药观结果
	    stringBuilder.append(" null as route_code, ");//临床路径项目编码
	    stringBuilder.append(" null as route_no, ");//临床路径项目序号
	    stringBuilder.append(" A1.sortno as Orderseqnum, ");//医嘱序号      
	    stringBuilder.append(" (case when A.fg_long = 'Y' then '长期' when A.fg_long = 'N' then '临时' end) as Ordertimetypename, ");//医嘱时间类型名称
	    stringBuilder.append(" (case when A.fg_long = 'Y' then '1' when A.fg_long = 'N' then '0' end) as Ordertimetype, ");//医嘱时间类型编码
	    stringBuilder.append(" a1.sd_su_bl as payflag ");//收费状态标识
		stringBuilder.append(" from ci_or_srv A1 ");
		stringBuilder.append(" left outer join ci_order A ON A1.Id_Or = A.Id_Or ");
		stringBuilder.append(" left outer join pi_pat B ON A.Id_Pat = B.Id_Pat ");
		stringBuilder.append(" left outer join en_ent C ON A.Id_En = C.Id_Ent ");
		stringBuilder.append(" left outer join bd_srv E ON E.Id_Srv = A1.Id_Srv ");
		stringBuilder.append(" left outer join bd_srvca D ON E.Id_Srvca = D.Id_Srvca ");
		stringBuilder.append(" left outer join bd_measdoc F ON F.Id_Measdoc = A1.Id_Medu ");
		stringBuilder.append(" left outer join bd_freq G ON G.Id_Freq = A1.Id_Freq ");
		stringBuilder.append(" left outer join bd_dep H ON H.Id_Dep = C.Id_Dep_Phy ");
		stringBuilder.append(" left outer join bd_dep I ON I.Id_Dep = C.Id_Dep_Nur ");
		stringBuilder.append(" left outer join bd_psndoc J ON J.Id_Psndoc = A1.Id_Emp_Srv ");
		stringBuilder.append(" left outer join bd_psndoc K ON K.Id_Psndoc = A.Id_Emp_Sign ");
		stringBuilder.append(" left outer join bd_dep L ON L.Id_Dep = A1.Id_Dep_Mp ");
		stringBuilder.append(" left outer join bd_udidoc M ON M.id_udidoc = A1.Id_Hpsrvtp ");
		stringBuilder.append(" left outer join BD_ENTP BD ON C.CODE_ENTP = BD.CODE ");
		stringBuilder.append(" left outer join en_ent_ip H1 ON C.Id_Ent = H1.Id_Ent ");
		stringBuilder.append(" left outer join en_ent_op J1 ON A.Id_En = J1.Id_Ent ");
		stringBuilder.append(" left outer join bd_udidoc Z3 ON (Z3.id_udidoc = '"+OrdEventUtil.ID_SU_BL_1+"' and Z3.id_udidoclist = '"+OrdEventUtil.SD_SU_BL+"') ");
		stringBuilder.append(" where A.id_or in (%s) ");
		stringBuilder.append(" and A1.Fg_or = 'Y' ");
		return stringBuilder.toString();
		}
}
